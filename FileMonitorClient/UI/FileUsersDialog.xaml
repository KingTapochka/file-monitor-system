<Window x:Class="FileMonitorClient.UI.FileUsersDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Кто использует файл?" 
        Height="400" 
        Width="600"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        Background="#F5F5F5">

    <Window.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <TextBlock Grid.Row="0" 
                   Text="Информация о файле" 
                   FontSize="16" 
                   FontWeight="Bold" 
                   Margin="0,0,0,10"/>

        <!-- Путь к файлу -->
        <Border Grid.Row="1" 
                Background="White" 
                BorderBrush="#CCCCCC" 
                BorderThickness="1" 
                Padding="10" 
                Margin="0,0,0,10"
                CornerRadius="3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" 
                           Text="Файл: " 
                           FontWeight="SemiBold" 
                           VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" 
                           x:Name="FilePathTextBlock" 
                           TextWrapping="Wrap" 
                           VerticalAlignment="Center"
                           Margin="5,0,0,0"/>
            </Grid>
        </Border>

        <!-- Индикатор загрузки -->
        <StackPanel Grid.Row="2" 
                    x:Name="LoadingPanel" 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Visibility="Visible">
            <ProgressBar Width="200" 
                         Height="20" 
                         IsIndeterminate="True" 
                         Margin="0,0,0,10"/>
            <TextBlock Text="Загрузка информации..." 
                       HorizontalAlignment="Center" 
                       FontSize="14"/>
        </StackPanel>

        <!-- Список пользователей -->
        <DataGrid Grid.Row="2" 
                  x:Name="UsersDataGrid"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  HeadersVisibility="Column"
                  GridLinesVisibility="Horizontal"
                  Background="White"
                  BorderBrush="#CCCCCC"
                  BorderThickness="1"
                  Visibility="Collapsed">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Пользователь" 
                                    Binding="{Binding UserName}" 
                                    Width="*"/>
                <DataGridTextColumn Header="Компьютер" 
                                    Binding="{Binding ClientName}" 
                                    Width="150"/>
                <DataGridTextColumn Header="Режим доступа" 
                                    Binding="{Binding AccessMode}" 
                                    Width="120"/>
                <DataGridTextColumn Header="Время открытия" 
                                    Binding="{Binding OpenedAt, StringFormat='HH:mm:ss'}" 
                                    Width="100"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Сообщение "Файл не открыт" -->
        <Border Grid.Row="2" 
                x:Name="NoUsersPanel"
                Background="White" 
                BorderBrush="#CCCCCC" 
                BorderThickness="1"
                Padding="20"
                CornerRadius="3"
                Visibility="Collapsed">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="✓" 
                           FontSize="48" 
                           Foreground="#4CAF50" 
                           HorizontalAlignment="Center" 
                           Margin="0,0,0,10"/>
                <TextBlock Text="Файл не используется" 
                           FontSize="16" 
                           HorizontalAlignment="Center"
                           Foreground="#666"/>
                <TextBlock Text="Никто не открыл этот файл" 
                           FontSize="12" 
                           HorizontalAlignment="Center"
                           Foreground="#999"
                           Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Сообщение об ошибке -->
        <Border Grid.Row="2" 
                x:Name="ErrorPanel"
                Background="#FFF3E0" 
                BorderBrush="#FF9800" 
                BorderThickness="1"
                Padding="15"
                CornerRadius="3"
                Visibility="Collapsed">
            <StackPanel>
                <TextBlock Text="⚠ Ошибка" 
                           FontSize="14" 
                           FontWeight="Bold" 
                           Foreground="#F57C00" 
                           Margin="0,0,0,5"/>
                <TextBlock x:Name="ErrorMessageTextBlock" 
                           TextWrapping="Wrap" 
                           Foreground="#E65100"/>
            </StackPanel>
        </Border>

        <!-- Информация о последнем обновлении -->
        <TextBlock Grid.Row="3" 
                   x:Name="LastUpdatedTextBlock"
                   FontSize="11" 
                   Foreground="#666" 
                   Margin="0,10,0,0"
                   HorizontalAlignment="Right"/>

        <!-- Кнопки -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,10,0,0">
            <Button Content="Обновить" 
                    x:Name="RefreshButton"
                    Width="100" 
                    Height="30" 
                    Margin="0,0,10,0"
                    Click="RefreshButton_Click"/>
            <Button Content="Закрыть" 
                    IsCancel="True" 
                    Width="100" 
                    Height="30"
                    Click="CloseButton_Click"/>
        </StackPanel>
    </Grid>
</Window>
