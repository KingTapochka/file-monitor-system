# üéØ MSI –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–°–æ–∑–¥–∞–Ω **–ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π MSI —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫** –Ω–∞ –±–∞–∑–µ WiX Toolset 4.0 —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

### üîß –§—É–Ω–∫—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞:

1. **–í—ã–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:**
   - ‚òëÔ∏è –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–ª—É–∂–±–∞ (FileMonitorService)
   - ‚òëÔ∏è –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (Shell Extension)
   - ‚òëÔ∏è –û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:**
   - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å–ª—É–∂–±—ã
   - –°–æ–∑–¥–∞–Ω–∏–µ Windows Service —á–µ—Ä–µ–∑ `sc create`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –ª–æ–≥–æ–≤
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:**
   - –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Shell Extension DLL
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è COM (32-bit –∏ 64-bit)
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Windows Explorer
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:**
   - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ Windows Service
   - –û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Shell Extension
   - –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
   - –û—á–∏—Å—Ç–∫–∞ —Ä–µ–µ—Å—Ç—Ä–∞
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

5. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (upgrade)
   - –¢–∏—Ö–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
   - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WiX Toolset

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ .NET CLI
dotnet tool install --global wix --version 4.0.4

# –ü—Ä–æ–≤–µ—Ä–∫–∞
wix --version
```

### 2Ô∏è‚É£ –°–±–æ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞

```powershell
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
cd c:\monitoring_polzovateley

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏
.\Scripts\Build-Installer.ps1

# MSI –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤: Installer\bin\Release\FileMonitorSetup.msi
```

### 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```powershell
# –° GUI (–≤—ã–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
msiexec /i "Installer\bin\Release\FileMonitorSetup.msi"

# –í—ã–±–µ—Ä–∏—Ç–µ: "–°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–ª—É–∂–±–∞"

# –ò–õ–ò —Ç–∏—Ö–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
msiexec /i "Installer\bin\Release\FileMonitorSetup.msi" ADDLOCAL=ServerFeature /qn
```

### 4Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—ã

```powershell
# –° GUI
msiexec /i "Installer\bin\Release\FileMonitorSetup.msi"

# –í—ã–±–µ—Ä–∏—Ç–µ: "–ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"

# –ò–õ–ò —Ç–∏—Ö–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
msiexec /i "Installer\bin\Release\FileMonitorSetup.msi" ADDLOCAL=ClientFeature /qn
```

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞

```
Installer/
‚îú‚îÄ‚îÄ FileMonitorInstaller.wixproj   # WiX –ø—Ä–æ–µ–∫—Ç
‚îú‚îÄ‚îÄ Product.wxs                     # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (UI, CustomActions)
‚îú‚îÄ‚îÄ ServerComponent.wxs             # –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ ClientComponent.wxs             # –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ README.md                       # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ QUICKSTART.md                   # –ë—ã—Å—Ç—Ä–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îî‚îÄ‚îÄ GUIDE.md                        # –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
```

### –§–∞–π–ª—ã WXS:

**Product.wxs** - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª:
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (–≤–µ—Ä—Å–∏—è, GUID, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Features (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π/–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- UI –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (WixUI_FeatureTree)
- Custom Actions –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è
- Install/Uninstall –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**ServerComponent.wxs** - –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ FileMonitorService.exe –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (appsettings.json)
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ logs
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ

**ClientComponent.wxs** - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ FileMonitorClient.dll
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (SharpShell.dll, Newtonsoft.Json.dll)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ

---

## üéõÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### msiexec –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å GUI
msiexec /i FileMonitorSetup.msi

# –¢–∏—Ö–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–±–µ–∑ UI)
msiexec /i FileMonitorSetup.msi /qn

# –° –±–∞–∑–æ–≤—ã–º UI (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å)
msiexec /i FileMonitorSetup.msi /qb

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–æ–º
msiexec /i FileMonitorSetup.msi /l*v install.log

# –£–¥–∞–ª–µ–Ω–∏–µ
msiexec /x FileMonitorSetup.msi /qn
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```powershell
# –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä
ADDLOCAL=ServerFeature

# –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç
ADDLOCAL=ClientFeature

# –û–±–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
ADDLOCAL=ALL
# –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å
```

### –ü—Ä–∏–º–µ—Ä—ã:

```powershell
# –¢–∏—Ö–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ª–æ–≥–æ–º
msiexec /i FileMonitorSetup.msi ADDLOCAL=ServerFeature /qn /l*v server.log

# –ë–∞–∑–æ–≤—ã–π UI –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
msiexec /i FileMonitorSetup.msi ADDLOCAL=ClientFeature /qb

# –û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –ª–æ–≥–æ–º
msiexec /i FileMonitorSetup.msi /qb /l*v full.log

# –£–¥–∞–ª–µ–Ω–∏–µ —Å –ª–æ–≥–æ–º
msiexec /x FileMonitorSetup.msi /qn /l*v uninstall.log
```

---

## üåê –ú–∞—Å—Å–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: Group Policy (GPO)

**–î–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤:**

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ MSI: `\\dc\netlogon\software\FileMonitorSetup.msi`
2. –û—Ç–∫—Ä–æ–π—Ç–µ GPMC.msc
3. –°–æ–∑–¥–∞–π—Ç–µ GPO: "File Monitor Server Installation"
4. Computer Configuration ‚Üí Policies ‚Üí Software Settings ‚Üí Software Installation
5. New ‚Üí Package ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ MSI
6. Deployment Method: Assigned
7. –í properties ‚Üí Deployment ‚Üí Advanced ‚Üí –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ UI level (–¥–ª—è GUI –≤—ã–±–æ—Ä–∞)
8. –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ transform (.mst) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ ServerFeature

**–î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:**

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ —Å –¥—Ä—É–≥–∏–º GPO –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤.

### –í–∞—Ä–∏–∞–Ω—Ç 2: PowerShell DSC

```powershell
Configuration FileMonitorInstallation {
    param (
        [string]$Component = "Client"
    )
    
    Import-DscResource -ModuleName PSDesiredStateConfiguration
    
    Node $AllNodes.NodeName {
        Package FileMonitor {
            Name = "File Monitor System"
            Path = "\\server\share\FileMonitorSetup.msi"
            ProductId = "{12345678-1234-1234-1234-123456789012}"
            Arguments = "ADDLOCAL=$($Component)Feature /qn"
            Ensure = "Present"
        }
    }
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: PowerShell Remoting

```powershell
# –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ã
$servers = "FileServer01", "FileServer02", "FileServer03"
$msiPath = "\\dc\share\FileMonitorSetup.msi"

Invoke-Command -ComputerName $servers -ScriptBlock {
    param($msi)
    Start-Process msiexec -ArgumentList "/i `"$msi`" ADDLOCAL=ServerFeature /qn" -Wait
} -ArgumentList $msiPath

# –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—ã
$computers = Get-ADComputer -Filter {OperatingSystem -like "*Windows 10*"} | 
             Select-Object -ExpandProperty Name

Invoke-Command -ComputerName $computers -ScriptBlock {
    param($msi)
    Start-Process msiexec -ArgumentList "/i `"$msi`" ADDLOCAL=ClientFeature /qn" -Wait
} -ArgumentList $msiPath -ThrottleLimit 10
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: SCCM/ConfigMgr

1. **–°–æ–∑–¥–∞–π—Ç–µ Application:**
   - Name: File Monitor Server
   - Deployment Type: Windows Installer (*.msi)
   
2. **Installation program:**
   ```
   msiexec /i FileMonitorSetup.msi ADDLOCAL=ServerFeature /qn
   ```

3. **Uninstall program:**
   ```
   msiexec /x {12345678-1234-1234-1234-123456789012} /qn
   ```

4. **Detection Method:**
   - Registry: `HKLM\SOFTWARE\FileMonitorSystem`
   - Value: ServerPath –∏–ª–∏ ClientPath

5. **Deployment:**
   - Deploy to —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Device Collections

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
.\Scripts\Test-Installer.ps1 -Component Server

# –ò–ª–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
.\Scripts\Test-Installer.ps1 -Component Client

# –ò–ª–∏ –æ–±–∞
.\Scripts\Test-Installer.ps1 -Component Both
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:

```powershell
# 1. –°–ª—É–∂–±–∞
Get-Service FileMonitorService
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Status=Running, StartType=Automatic

# 2. –§–∞–π–ª—ã
Test-Path "C:\Program Files\File Monitor System\Service\FileMonitorService.exe"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: True

# 3. API
Invoke-RestMethod -Uri "http://localhost:5000/api/files/health"
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: {"status":"healthy",...}

# 4. –†–µ–µ—Å—Ç—Ä
Get-ItemProperty "HKLM:\SOFTWARE\FileMonitorSystem" -Name ServerPath
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—É—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:

```powershell
# 1. –§–∞–π–ª—ã
Test-Path "C:\Program Files\File Monitor System\Client\FileMonitorClient.dll"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: True

# 2. COM —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
reg query "HKCR\*\shellex\ContextMenuHandlers" /s | findstr "FileMonitor"
# –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Å—å

# 3. –í–∏–∑—É–∞–ª—å–Ω–æ
# –û—Ç–∫—Ä–æ–π—Ç–µ Explorer ‚Üí –ü–ö–ú –Ω–∞ —Ñ–∞–π–ª–µ ‚Üí –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–Ω–∫—Ç "–ö—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª?"
```

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ MSI

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Error: Failed to build MSI
```

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WiX
wix --version

# 2. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ WiX
dotnet tool uninstall --global wix
dotnet tool install --global wix --version 4.0.4

# 3. –û—á–∏—Å—Ç–∏—Ç–µ –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
.\Scripts\Build-Installer.ps1 -Clean

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç—ã —Å–æ–±—Ä–∞–Ω—ã
cd FileMonitorService
dotnet publish -c Release
cd ..\FileMonitorClient
dotnet build -c Release
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–ª—É–∂–±–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- MSI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ
- –ù–æ —Å–ª—É–∂–±–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
Get-Content "$env:TEMP\install.log" | Select-String "error"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Custom Actions
Get-Content "$env:TEMP\install.log" | Select-String "InstallServerService"

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
sc create FileMonitorService binPath="C:\Program Files\File Monitor System\Service\FileMonitorService.exe"

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞
whoami /groups | findstr "S-1-5-32-544"  # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
```

### –ü—Ä–æ–±–ª–µ–º–∞: Shell Extension –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–ª–∏–µ–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ù–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Explorer
taskkill /f /im explorer.exe
explorer.exe

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
reg query "HKCR\*\shellex\ContextMenuHandlers" /s

# 3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é
cd "C:\Program Files\File Monitor System\Client"
regasm FileMonitorClient.dll /codebase

# 4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä
Restart-Computer
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Error 1603: Fatal error during installation
```

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–ª—É–∂–±—É –≤—Ä—É—á–Ω—É—é
sc stop FileMonitorService

# 2. –£–¥–∞–ª–∏—Ç–µ —á–µ—Ä–µ–∑ msiexec
msiexec /x FileMonitorSetup.msi /qn /l*v uninstall.log

# 3. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ, —É–¥–∞–ª–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
sc delete FileMonitorService
regasm "C:\Program Files\File Monitor System\Client\FileMonitorClient.dll" /unregister
Remove-Item "C:\Program Files\File Monitor System" -Recurse -Force

# 4. –û—á–∏—Å—Ç–∏—Ç–µ —Ä–µ–µ—Å—Ç—Ä
Remove-Item "HKLM:\SOFTWARE\FileMonitorSystem" -Force
```

---

## üìä –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞ msiexec

| –ö–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----|----------|
| 0 | –£—Å–ø–µ—Ö |
| 1602 | –û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º |
| 1603 | –§–∞—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ |
| 1618 | –î—Ä—É–≥–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è |
| 1619 | –ù–µ —É–¥–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å MSI –ø–∞–∫–µ—Ç |
| 1625 | –ù–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π |
| 3010 | –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ |

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

- [ ] WiX Toolset —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ü—Ä–æ–µ–∫—Ç—ã —Å–æ–±—Ä–∞–Ω—ã (Server + Client)
- [ ] MSI —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –µ—Å—Ç—å

### –°–µ—Ä–≤–µ—Ä:

- [ ] .NET 8 Runtime —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] PowerShell 5.1+ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] SMB File Server –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü–æ—Ä—Ç—ã 5000/5001 —Å–≤–æ–±–æ–¥–Ω—ã
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –ö–ª–∏–µ–Ω—Ç:

- [ ] .NET Framework 4.8 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –ü—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é COM –µ—Å—Ç—å
- [ ] –ê–¥—Ä–µ—Å API —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑–≤–µ—Å—Ç–µ–Ω

### –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

- [ ] –°–ª—É–∂–±–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å–µ—Ä–≤–µ—Ä)
- [ ] API –¥–æ—Å—Ç—É–ø–µ–Ω (—Å–µ—Ä–≤–µ—Ä)
- [ ] Shell Extension –ø–æ—è–≤–∏–ª–∞—Å—å (–∫–ª–∏–µ–Ω—Ç)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—ã —Å–æ–∑–¥–∞–ª–∏ **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π MSI —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫** —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏:

‚úÖ –í—ã–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Windows Service
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Shell Extension  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!
