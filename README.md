# File Monitor - ะกะธััะตะผะฐ ะพััะปะตะถะธะฒะฐะฝะธั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะฐะนะปะพะฒ

ะะพะปะฝะพะต ัะตัะตะฝะธะต ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ะพัะบััััั ัะฐะนะปะพะฒ ะฝะฐ Windows Server ั ะบะปะธะตะฝััะบะธะผ ัะฐััะธัะตะฝะธะตะผ ะดะปั Windows Explorer.

## โก ะะซะกะขะะซะ ะกะขะะะข

**ะฃััะฐะฝะพะฒะบะฐ ะณะพัะพะฒะฐ! ะกะปะตะดัะนัะต ะธะฝััััะบัะธัะผ ะฒ:** [`START_INSTALL.md`](START_INSTALL.md)

**ะัะปะธ ััะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั:** [`TROUBLESHOOTING.md`](TROUBLESHOOTING.md)

## ๐ ะะพะผะฟะพะฝะตะฝัั ัะตัะตะฝะธั

### 1. FileMonitorService (ะกะตัะฒะตัะฝะฐั ัะฐััั)
Windows Service ะฝะฐ .NET 8 ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ะพัะบััััั ัะฐะนะปะพะฒ ัะตัะตะท SMB.

**ะะพะทะผะพะถะฝะพััะธ:**
- ะะพะฝะธัะพัะธะฝะณ ัะตัะตะท PowerShell `Get-SmbOpenFile`
- REST API ะดะปั ะทะฐะฟัะพัะพะฒ
- In-memory ะบััะธัะพะฒะฐะฝะธะต
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ะบะฐะถะดัะต 10 ัะตะบัะฝะด
- ะะพะณะธัะพะฒะฐะฝะธะต ัะตัะตะท Serilog

**ะะพััั:**
- HTTP: `5000`
- HTTPS: `5001`

### 2. FileMonitorClient (ะะปะธะตะฝััะบะฐั ัะฐััั)
Shell Extension ะฝะฐ .NET Framework 4.8 ะดะปั ะธะฝัะตะณัะฐัะธะธ ั Windows Explorer.

**ะะพะทะผะพะถะฝะพััะธ:**
- ะะพะฝัะตะบััะฝะพะต ะผะตะฝั "ะัะพ ะธัะฟะพะปัะทัะตั ัะฐะนะป?"
- WPF ะพะบะฝะพ ั ัะฐะฑะปะธัะตะน ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- HTTP ะบะปะธะตะฝั ะดะปั ัะฒัะทะธ ั ัะตัะฒะตัะพะผ
- ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ

## ๐ ะัััััะน ััะฐัั

### ะะฐัะธะฐะฝั 1: ะฃััะฐะฝะพะฒะบะฐ ัะตัะตะท MSI (ะะตะบะพะผะตะฝะดัะตััั)

```powershell
# 1. ะกะฑะพัะบะฐ ัััะฐะฝะพะฒัะธะบะฐ
.\Scripts\Build-Installer.ps1

# 2. ะฃััะฐะฝะพะฒะบะฐ ะะะะะฅ ะบะพะผะฟะพะฝะตะฝัะพะฒ
msiexec /i "Installer\FileMonitorSetup.msi"

# 3. ะฃััะฐะฝะพะฒะบะฐ ะขะะะฌะะ ัะตัะฒะตัะฐ (ะดะปั ัะฐะนะปะพะฒะพะณะพ ัะตัะฒะตัะฐ)
msiexec /i "Installer\FileMonitorSetup.msi" ADDLOCAL=ServerFeature /qb

# 4. ะฃััะฐะฝะพะฒะบะฐ ะขะะะฌะะ ะบะปะธะตะฝัะฐ (ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปััะบะธั ะผะฐัะธะฝ)
msiexec /i "Installer\FileMonitorSetup.msi" ADDLOCAL=ClientFeature /qb

# ะฃะดะฐะปะตะฝะธะต
msiexec /x "Installer\FileMonitorSetup.msi" /qn
```

### ะะฐัะธะฐะฝั 2: ะฃััะฐะฝะพะฒะบะฐ ัะตัะตะท PowerShell ัะบัะธะฟัั

**ะกะตัะฒะตัะฝะฐั ัะฐััั:**

```powershell
# ะฃััะฐะฝะพะฒะบะฐ
.\Scripts\Install-Service.ps1

# ะัะพะฒะตัะบะฐ
Invoke-RestMethod -Uri "http://localhost:5000/api/files/health"

# ะฃะดะฐะปะตะฝะธะต
.\Scripts\Uninstall-Service.ps1
```

**ะะปะธะตะฝััะบะฐั ัะฐััั:**

```powershell
# ะฃััะฐะฝะพะฒะบะฐ
.\Scripts\Install-Client.ps1 -Force

# ะฃะดะฐะปะตะฝะธะต
.\Scripts\Uninstall-Client.ps1 -Force
```

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

1. **ะัะบัะพะนัะต ัะฐะนะป** ะฝะฐ ัะตัะตะฒะพะน ะฟะฐะฟะบะต ั ะดััะณะพะณะพ ะบะพะผะฟัััะตัะฐ
2. **ะะฐะถะผะธัะต ะฟัะฐะฒะพะน ะบะฝะพะฟะบะพะน** ะฝะฐ ัะฐะนะปะต
3. **ะัะฑะตัะธัะต** "ะัะพ ะธัะฟะพะปัะทัะตั ัะฐะนะป?"
4. **ะฃะฒะธะดะธัะต ัะฟะธัะพะบ** ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะธะฝัะพัะผะฐัะธะตะน:
   - ะะผั ะฟะพะปัะทะพะฒะฐัะตะปั
   - ะะพะผะฟัััะตั
   - ะะตะถะธะผ ะดะพัััะฟะฐ (Read/Write)
   - ะัะตะผั ะพัะบัััะธั

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     Windows Server 2019                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  FileMonitorService               โ  โ
โ  โ  - Get-SmbOpenFile                โ  โ
โ  โ  - REST API (5000/5001)           โ  โ
โ  โ  - In-memory Cache                โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ HTTPS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     Windows 10/11 (ะะปะธะตะฝั)              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  FileMonitorClient                โ  โ
โ  โ  - Shell Extension                โ  โ
โ  โ  - Context Menu Handler           โ  โ
โ  โ  - WPF UI                         โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ง ะะพะฝัะธะณััะฐัะธั

### FileMonitorService (appsettings.json)

```json
{
  "FileMonitor": {
    "RefreshIntervalSeconds": 10,
    "CacheExpirationMinutes": 5
  },
  "Kestrel": {
    "Endpoints": {
      "Http": { "Url": "http://localhost:5000" },
      "Https": { "Url": "https://localhost:5001" }
    }
  }
}
```

### FileMonitorClient

ะะทะผะตะฝะธัะต ะฐะดัะตั API ะฒ `FileMonitorApiClient.cs`:

```csharp
public FileMonitorApiClient(string baseUrl = "http://your-server:5000")
```

## ๐ก API Endpoints

### GET /api/files/users?filePath={ะฟััั}
ะะพะปััะธัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะฐะนะปะฐ.

### GET /api/files/active
ะะพะปััะธัั ะฒัะต ะฐะบัะธะฒะฝัะต ัะฐะนะปั.

### GET /api/files/user/{userName}
ะะพะปััะธัั ัะฐะนะปั ะฟะพะปัะทะพะฒะฐัะตะปั.

### POST /api/files/refresh
ะัะธะฝัะดะธัะตะปัะฝะพ ะพะฑะฝะพะฒะธัั ะบัั.

### GET /api/files/health
ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ.

## ๐๏ธ ะขัะตะฑะพะฒะฐะฝะธั

### ะะปั ัะฑะพัะบะธ ัััะฐะฝะพะฒัะธะบะฐ
- .NET 8 SDK
- WiX Toolset 4.0.4 (`dotnet tool install --global wix`)
- PowerShell 5.1+

### ะกะตัะฒะตัะฝะฐั ัะฐััั
- Windows Server 2016+ ะธะปะธ Windows 10+
- .NET 8.0 Runtime
- PowerShell 5.1+
- SMB File Server
- ะัะฐะฒะฐ ะฐะดะผะธะฝะธัััะฐัะพัะฐ

### ะะปะธะตะฝััะบะฐั ัะฐััั
- Windows 10/11
- .NET Framework 4.8
- ะัะฐะฒะฐ ะฐะดะผะธะฝะธัััะฐัะพัะฐ (ัะพะปัะบะพ ะดะปั ัััะฐะฝะพะฒะบะธ)

## ๐ ะะพะณะธัะพะฒะฐะฝะธะต

### ะกะตัะฒะตั
ะะพะณะธ ะฒ ะฟะฐะฟะบะต `logs/service-YYYYMMDD.txt`

### ะะปะธะตะฝั
ะัะธะฑะบะธ ะพัะพะฑัะฐะถะฐัััั ะฒ UI, ัะฐะบะถะต ะผะพะถะฝะพ ะฟัะพะฒะตัะธัั Event Viewer.

## โ๏ธ ะะทะฒะตััะฝัะต ะพะณัะฐะฝะธัะตะฝะธั

1. **Get-SmbOpenFile** ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ะฝะฐ Windows Server ั SMB
2. ะขัะตะฑััััั **ะฟัะฐะฒะฐ ะฐะดะผะธะฝะธัััะฐัะพัะฐ** ะดะปั ัะปัะถะฑั
3. **ะะพะบะฐะปัะฝัะต ัะฐะนะปั** (ะฝะต SMB) ะฝะต ะพััะปะตะถะธะฒะฐัััั
4. Shell Extension ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ะดะปั **ะพะดะฝะพะณะพ ัะฐะนะปะฐ** ะทะฐ ัะฐะท

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะกะปัะถะฑะฐ ะฝะต ะทะฐะฟััะบะฐะตััั
```powershell
# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
Get-Content C:\Services\FileMonitorService\logs\service-*.txt -Tail 50

# ะัะพะฒะตัะบะฐ ะฟัะฐะฒ
whoami /priv
```

### ะัะฝะบั ะผะตะฝั ะฝะต ะฟะพัะฒะปัะตััั
```powershell
# ะัะพะฒะตัะบะฐ ัะตะณะธัััะฐัะธะธ
reg query HKCR\*\shellex\ContextMenuHandlers

# ะะตัะตัััะฐะฝะพะฒะบะฐ
srm uninstall FileMonitorClient.dll
srm install FileMonitorClient.dll -codebase
taskkill /f /im explorer.exe ; explorer.exe
```

### ะัะธะฑะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ API
```powershell
# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ
Test-NetConnection localhost -Port 5000

# ะัะพะฒะตัะบะฐ ัะปัะถะฑั
sc query FileMonitorService

# ะัะพะฒะตัะบะฐ firewall
netsh advfirewall firewall show rule name="FileMonitorService"
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- ะัะฟะพะปัะทัะนัะต **HTTPS** ะฒ ะฟัะพะดะฐะบัะตะฝะต
- ะะฐัััะพะนัะต **Windows Authentication** ะดะปั API
- ะะณัะฐะฝะธัััะต ะดะพัััะฟ ะบ ะฟะพััะฐะผ ัะตัะตะท **Firewall**
- ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปัะนัะต ะทะฐะฒะธัะธะผะพััะธ

## ๐ฆ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
monitoring_polzovateley/
โโโ FileMonitorService/           # ะกะตัะฒะตัะฝะฐั ัะฐััั (.NET 8)
โ   โโโ Controllers/              # REST API ะบะพะฝััะพะปะปะตัั
โ   โโโ Models/                   # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โโโ Services/                 # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ Program.cs                # ะขะพัะบะฐ ะฒัะพะดะฐ
โ   โโโ appsettings.json          # ะะพะฝัะธะณััะฐัะธั
โโโ FileMonitorClient/            # ะะปะธะตะฝััะบะฐั ัะฐััั (.NET Framework 4.8)
โ   โโโ Models/                   # API ะผะพะดะตะปะธ
โ   โโโ Services/                 # HTTP ะบะปะธะตะฝั
โ   โโโ UI/                       # WPF ะธะฝัะตััะตะนั
โ   โโโ FileMonitorContextMenu.cs # Shell Extension
โโโ Installer/                    # MSI ัััะฐะฝะพะฒัะธะบ (WiX)
โ   โโโ Product.wxs               # ะะฟัะตะดะตะปะตะฝะธะต ะฟัะพะดัะบัะฐ
โ   โโโ ServerComponent.wxs       # ะกะตัะฒะตัะฝัะต ะบะพะผะฟะพะฝะตะฝัั
โ   โโโ ClientComponent.wxs       # ะะปะธะตะฝััะบะธะต ะบะพะผะฟะพะฝะตะฝัั
โ   โโโ README.md                 # ะะพะบัะผะตะฝัะฐัะธั ัััะฐะฝะพะฒัะธะบะฐ
โโโ Scripts/                      # PowerShell ัะบัะธะฟัั
โ   โโโ Install-Service.ps1       # ะฃััะฐะฝะพะฒะบะฐ ัะตัะฒะตัะฐ
โ   โโโ Install-Client.ps1        # ะฃััะฐะฝะพะฒะบะฐ ะบะปะธะตะฝัะฐ
โ   โโโ Build-Installer.ps1       # ะกะฑะพัะบะฐ MSI
โ   โโโ Test-Api.ps1              # ะขะตััะธัะพะฒะฐะฝะธะต API
โโโ README.md                     # ะัะฝะพะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
โโโ DEPLOYMENT.md                 # ะัะบะพะฒะพะดััะฒะพ ะฟะพ ัะฐะทะฒะตัััะฒะฐะฝะธั
```

## ๐ฆ ะกัะฐััั ัะฐะทัะฐะฑะพัะบะธ

- โ ะกะตัะฒะตัะฝะฐั ัะปัะถะฑะฐ (Windows Service)
- โ ะะพะฝะธัะพัะธะฝะณ ัะตัะตะท Get-SmbOpenFile
- โ REST API (5 endpoints)
- โ In-memory ะบััะธัะพะฒะฐะฝะธะต
- โ Shell Extension (SharpShell)
- โ WPF UI ั ะบัะฐัะธะฒัะผ ะดะธะทะฐะนะฝะพะผ
- โ MSI ัััะฐะฝะพะฒัะธะบ ั ะฒัะฑะพัะพะผ ะบะพะผะฟะพะฝะตะฝัะพะฒ
- โ PowerShell ัะบัะธะฟัั ัััะฐะฝะพะฒะบะธ
- โ ะะฒัะพะผะฐัะธัะตัะบะพะต ัะดะฐะปะตะฝะธะต ะฟัะธ ะดะตะธะฝััะฐะปะปััะธะธ
- โณ ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ Windows 10/11/Server 2019+

## ๐ ะะธัะตะฝะทะธั

MIT License

## ๐ฅ ะะฒัะพั

ะัะพะตะบั ัะพะทะดะฐะฝ ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ัะฐะนะปะพะฒะพะณะพ ัะตัะฒะตัะฐ Windows Server 2019.
